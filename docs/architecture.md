# アーキテクチャドキュメント

## プロジェクト概要

live-grep-cliは、fzf、ripgrep、batなどのUnixツールを組み合わせて、リアルタイムのファイル内容検索機能を提供するインタラクティブなコマンドラインツールです。

## 依存関係

- **fzf**: インタラクティブなファジーファインダー
- **ripgrep (rg)**: 高速な行指向検索ツール
- **bat**: シンタックスハイライト付きファイルビューワー
- **bash 4.0+**: シェルスクリプト実行環境
- **curl**: インストール/アップデート用

## ファイル構造

```
.
├── live-grep        # メイン実行スクリプト
├── docs/            # ドキュメントディレクトリ
├── test/            # テストファイル
├── README.md        # 英語のドキュメント
├── README.ja.md     # 日本語のドキュメント
├── LICENSE          # MITライセンス
└── .gitignore      # Gitの除外パターン
```

## コアコンポーネント

### メインスクリプト (live-grep)

メインスクリプトは以下の主要な機能で構成されています：

1. **設定管理**
   - バージョン管理
   - プレビューのコンテキスト設定
   - 一時ディレクトリの管理

2. **依存関係管理**
   - `check_dependencies()`: 必要なツールがすべてインストールされているか確認

3. **一時リソース管理**
   - `setup_temp()`: 一時ディレクトリとスクリプトの作成
   - `cleanup()`: 終了時のリソースクリーンアップ

4. **検索実行**
   - `execute_search()`: 検索プロセスのライフサイクル管理
   - `format_output()`: 設定に基づく検索結果のフォーマット

5. **ユーザーインターフェース**
   - fzfを使用したインタラクティブな検索
   - batによるシンタックスハイライト付きプレビュー
   - ripgrepによるリアルタイム結果表示

## 実装の詳細

### 検索プロセス

1. fzfインターフェースを通じてユーザー入力を取得
2. ripgrepが指定されたオプションでファイル検索を実行
3. 結果をリアルタイムでシンタックスハイライト付きで表示
4. プレビューウィンドウでbatを使用してファイルのコンテキストを表示

### リソース管理

- プレビューとクリーンアップスクリプト用の一時ディレクトリを作成
- 適切なクリーンアップによるプロセスライフサイクルの管理
- クリーンな終了のためのシグナル処理

### コマンドラインインターフェース

以下のオプションをサポート：

- ファイルパターンのフィルタリング
- 検索深度の制御
- コンテキスト行数の設定
- ディレクトリの除外
- 行番号の出力

## 設定

ツールはコマンドライン引数で設定可能：

```bash
-p, --pattern PATTERN    # 検索するファイルパターン
-d, --depth DEPTH       # 最大検索深度
-c, --context LINES     # コンテキスト行数
-e, --exclude PATTERN   # 除外パターン
-n, --line-number      # 行番号を表示
```

## インストール

ツールはユーザーのローカルbinディレクトリにインストールされます：

- デフォルト: `$HOME/.local/bin`
- XDG互換: `$XDG_BIN_HOME`

## テスト

機能の検証用のテストファイルは`test/`ディレクトリに配置されています。
